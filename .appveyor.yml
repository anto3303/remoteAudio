platform:
  - x86
environment:
  global:
    APPVEYOR_OS_NAME: windows
    GOPATH: c:\gopath
    GOARCH: 386
    GOOS: windows
    CGO_ENABLED: 1
  matrix:
    #- MSYS2_ARCH: x86_64
    #  MSYS2_BITS: 64
    #  MSYSTEM: MSYS2
    #  METHOD: ci
    #- MSYS2_ARCH: i686
    #  MSYS2_BITS: 32
    #  MSYSTEM: MINGW32
    #  METHOD: cross
    - MSYS2_ARCH: i686
      MSYS2_BITS: 32
      MSYSTEM: MINGW32
      METHOD: cross
      MSYS2_BASEVER: 20150916
clone_folder: c:\gopath\src\github.com\dh1tw\remoteAudio
clone_script:
    - cmd: git clone --recursive -q --branch=%APPVEYOR_REPO_BRANCH% https://github.com/%APPVEYOR_REPO_NAME%.git %APPVEYOR_BUILD_FOLDER%
    - cmd: cd %APPVEYOR_BUILD_FOLDER%
    - cmd: git checkout -qf %APPVEYOR_REPO_COMMIT%
    # - cmd: git submodule update --init --recursive
install:
  - .\ci\install-deps-windows.bat
#   - go get -u github.com/cskr/pubsub
#   - go get -u github.com/GeertJohan/go.rice
#   - go get -u github.com/GeertJohan/go.rice/embedded
#   - go get -u github.com/gordonklaus/portaudio
#   - go get -u github.com/dh1tw/gosamplerate
#   - go get -u github.com/eclipse/paho.mqtt.golang
#   - go get -u github.com/gogo/protobuf/proto
#   - go get -u github.com/golang/protobuf/proto
#   - go get -u github.com/gorilla/websocket
#   - go get -u github.com/spf13/cobra
#   - go get -u github.com/spf13/viper
#   - go get -u github.com/zfjagann/golang-ring
#   - go get -u gopkg.in/hraban/opus.v2
#   - cd c:\gopath\src\github.com\dh1tw\remoteAudio
#   - go get ./...
  - '%MSYS_PATH%\usr\bin\bash -lc "cd /c/gopath/src/github.com/dh1tw/remoteAudio && go get -v ./..."'
build_script:
  - '%MSYS_PATH%\usr\bin\bash -lc "cd /c/gopath/src/github.com/dh1tw/remoteAudio && ls -al && pwd && go build"'
after_build:
  - .\ci\build-windows-bundle.bat
artifacts:
  - path: remoteAudio.zip
    name: remoteAudio
# deploy_script:
#   - SET APPVEYOR_BUILD_VERSION=%APPVEYOR_REPO_BRANCH%
#   - if "%APPVEYOR_REPO_TAG%" == "true" set APPVEYOR_BUILD_VERSION=%APPVEYOR_REPO_TAG_NAME%
#   - curl -T coyim.zip -u "%BINTRAY_USER%:%BINTRAY_APIKEY%" "https://api.bintray.com/content/twstrike/coyim/coyim-bin/%APPVEYOR_BUILD_VERSION%/%APPVEYOR_BUILD_VERSION%/windows/CoyIM.zip?override=1&publish=1"
